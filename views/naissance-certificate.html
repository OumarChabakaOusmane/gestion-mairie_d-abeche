<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acte de Naissance - République du Tchad</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @media print {
            body { padding: 0; margin: 0; }
            .container { width: 100%; max-width: 100%; padding: 0; }
            .no-print { display: none !important; }
            .certificate-container { box-shadow: none; border: 1px solid #000; }
        }
        body { background-color: #f0f3f5; padding: 20px 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .certificate-container { background-color: white; border: 2px solid #0e5b23; border-radius: 8px; padding: 30px; box-shadow: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.2); max-width: 800px; margin: 0 auto; position: relative; }
        .header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #0e5b23; padding-bottom: 15px; }
        .tchad-flag { height: 40px; background: linear-gradient(90deg, #002664 0%, #002664 33%, #FECB00 33%, #FECB00 66%, #C60C30 66%, #C60C30 100%); margin-bottom: 15px; border-radius: 4px; }
        .section-title { border-bottom: 1px solid #dee2e6; padding-bottom: 5px; margin: 25px 0 15px; color: #0e5b23; font-weight: bold; }
        .signature-area { margin-top: 50px; text-align: right; }
        .footer { margin-top: 30px; text-align: center; font-size: 0.9rem; color: #6c757d; border-top: 1px solid #dee2e6; padding-top: 15px; }
        .info-label { font-weight: bold; color: #0e5b23; }
        .document-number { position: absolute; top: 10px; left: 20px; font-size: 12px; color: #6c757d; }
        .watermark { position: absolute; opacity: 0.1; font-size: 80px; transform: rotate(-45deg); top: 40%; left: 15%; color: #0e5b23; font-weight: bold; pointer-events: none; }
    </style>
    <script>
      async function loadData() {
        try {
          const parts = window.location.pathname.split('/');
          const id = parts[parts.length - 2] === 'preview' ? parts[parts.length - 3] : parts.pop();
          const res = await fetch(`/api/actes/${id}`, { headers: { 'Authorization': `Bearer ${localStorage.getItem('token')||''}` } });
          const json = await res.json();
          if (!json.success) throw new Error('Données introuvables');
          const acte = json.data;
          const d = acte.details || {};
          const txt = (v, fallback='') => (v===undefined||v===null||v==='')?fallback:v;
          document.getElementById('docNumber').textContent = `N°: ${txt(acte.numeroActe, acte._id)}`;
          document.getElementById('republique').textContent = 'RÉPUBLIQUE DU TCHAD';
          document.getElementById('devise').textContent = 'Unité - Travail - Progrès';
          // Enfant
          document.getElementById('enfantNom').textContent = txt(d.nom).toString().toUpperCase();
          document.getElementById('enfantPrenoms').textContent = txt(d.prenom);
          document.getElementById('enfantSexe').textContent = d.sexe==='M'?'Masculin':(d.sexe==='F'?'Féminin':'Non spécifié');
          document.getElementById('enfantDate').textContent = d.dateNaissance ? new Date(d.dateNaissance).toLocaleDateString('fr-FR') : '';
          document.getElementById('enfantHeure').textContent = txt(d.heureNaissance,'');
          document.getElementById('enfantLieu').textContent = txt(d.lieuNaissance,'');
          // Parents
          document.getElementById('pere').textContent = `${txt(d.pere||d.nomPere,'')} ${txt(d.prenomPere,'')}`.trim();
          document.getElementById('pereDate').textContent = d.dateNaissancePere ? new Date(d.dateNaissancePere).toLocaleDateString('fr-FR') : '';
          document.getElementById('pereLieu').textContent = txt(d.lieuNaissancePere,'');
          document.getElementById('mere').textContent = `${txt(d.mere||d.nomMere,'')} ${txt(d.prenomMere,'')}`.trim();
          document.getElementById('mereDate').textContent = d.dateNaissanceMere ? new Date(d.dateNaissanceMere).toLocaleDateString('fr-FR') : '';
          document.getElementById('mereLieu').textContent = txt(d.lieuNaissanceMere,'');
          // Déclaration
          const dateEnreg = acte.dateEnregistrement ? new Date(acte.dateEnregistrement).toLocaleDateString('fr-FR') : '';
          document.getElementById('declDate').textContent = dateEnreg;
          document.getElementById('declHeure').textContent = txt(d.heureDeclaration,'');
          document.getElementById('declarant').textContent = `${txt(d.nomDeclarant,'')} ${txt(d.prenomsDeclarant,'')}${d.lienDeclarant?` (${d.lienDeclarant})`:''}`.trim();
          document.getElementById('declLieu').textContent = txt(acte.mairie,'');
          document.getElementById('officier').textContent = txt(d.officierEtatCivil,'');
          // Mentions
          document.getElementById('mentionNumero').textContent = txt(acte.numeroActe, acte._id);
          document.getElementById('mentionVolume').textContent = txt(d.volume,'');
          document.getElementById('mentionEdition').textContent = new Date().toLocaleDateString('fr-FR');
          document.getElementById('mentionRegistre').textContent = 'Naissances';
          // Signature/footer
          document.getElementById('maireVille').textContent = txt(acte.mairie,'');
          document.getElementById('maireNom').textContent = txt(d.maire,'');
        } catch (e) {
          console.error(e);
        }
      }
      document.addEventListener('DOMContentLoaded', loadData);
    </script>
</head>
<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="certificate-container">
                    <div class="watermark">RÉPUBLIQUE DU TCHAD</div>
                    <div class="document-number" id="docNumber">N°: —</div>
                    <div class="header">
                        <div class="tchad-flag"></div>
                        <h2 class="mb-1" id="republique">RÉPUBLIQUE DU TCHAD</h2>
                        <h4 class="mb-0" id="devise">Unité - Travail - Progrès</h4>
                        <h1 class="mb-0 mt-3" style="color: #0e5b23;">ACTE DE NAISSANCE</h1>
                        <p class="mb-0">Extrait des registres de l'état civil</p>
                    </div>

                    <h4 class="section-title"><i class="fas fa-child"></i> INFORMATIONS SUR L'ENFANT</h4>
                    <div class="row">
                        <div class="col-md-6 mb-2"><span class="info-label">Nom de famille :</span> <span id="enfantNom"></span></div>
                        <div class="col-md-6 mb-2"><span class="info-label">Prénom(s) :</span> <span id="enfantPrenoms"></span></div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-2"><span class="info-label">Sexe :</span> <span id="enfantSexe"></span></div>
                        <div class="col-md-6 mb-2"><span class="info-label">Date de naissance :</span> <span id="enfantDate"></span></div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-2"><span class="info-label">Heure de naissance :</span> <span id="enfantHeure"></span></div>
                        <div class="col-md-6 mb-2"><span class="info-label">Lieu de naissance :</span> <span id="enfantLieu"></span></div>
                    </div>

                    <h4 class="section-title"><i class="fas fa-users"></i> INFORMATIONS SUR LES PARENTS</h4>
                    <div class="row">
                        <div class="col-md-6">
                            <p class="mb-1"><span class="info-label">Père :</span> <span id="pere"></span></p>
                            <p class="mb-1"><span class="info-label">Date de naissance :</span> <span id="pereDate"></span></p>
                            <p class="mb-1"><span class="info-label">Lieu de naissance :</span> <span id="pereLieu"></span></p>
                        </div>
                        <div class="col-md-6">
                            <p class="mb-1"><span class="info-label">Mère :</span> <span id="mere"></span></p>
                            <p class="mb-1"><span class="info-label">Date de naissance :</span> <span id="mereDate"></span></p>
                            <p class="mb-1"><span class="info-label">Lieu de naissance :</span> <span id="mereLieu"></span></p>
                        </div>
                    </div>

                    <h4 class="section-title"><i class="fas fa-file-alt"></i> DÉCLARATION DE NAISSANCE</h4>
                    <div class="row">
                        <div class="col-md-6 mb-2"><span class="info-label">Déclarée le :</span> <span id="declDate"></span></div>
                        <div class="col-md-6 mb-2"><span class="info-label">Heure :</span> <span id="declHeure"></span></div>
                    </div>
                    <div class="row"><div class="col-12 mb-2"><span class="info-label">Déclarant :</span> <span id="declarant"></span></div></div>
                    <div class="row"><div class="col-12 mb-2"><span class="info-label">Lieu de déclaration :</span> <span id="declLieu"></span></div></div>
                    <div class="row"><div class="col-12 mb-2"><span class="info-label">Officier de l'état civil :</span> <span id="officier"></span></div></div>

                    <h4 class="section-title"><i class="fas fa-info-circle"></i> MENTIONS MARGINALES</h4>
                    <div class="row">
                        <div class="col-md-6 mb-2"><span class="info-label">Numéro d'acte :</span> <span id="mentionNumero"></span></div>
                        <div class="col-md-6 mb-2"><span class="info-label">Volume :</span> <span id="mentionVolume"></span></div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-2"><span class="info-label">Date d'édition :</span> <span id="mentionEdition"></span></div>
                        <div class="col-md-6 mb-2"><span class="info-label">Registre :</span> <span id="mentionRegistre"></span></div>
                    </div>

                    <div class="signature-area">
                        <p>Le Maire de <span id="maireVille"></span>,</p>
                        <p id="maireNom"></p>
                        <div class="signature-line" style="width: 250px; border-bottom: 1px solid #000; margin-left: auto; margin-bottom: 5px;"></div>
                        <div style="width: 250px; text-align: center; margin-left: auto; font-size: 12px;">Signature et cachet</div>
                    </div>

                    <div class="footer">
                        <p>Document officiel délivré par la Mairie</p>
                        <p>Ce document est un modèle et n'a aucune valeur légale</p>
                    </div>
                </div>

                <div class="text-center mt-4 no-print">
                    <button onclick="window.print()" class="btn btn-success">
                        <i class="fas fa-print"></i> Exporter en PDF / Imprimer
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>


